<html>
    <head>
        <title>Coinview</title>
        <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
        <link rel="stylesheet" href="styles.css">
    </head>

    <body>
        <h1>BTC trades with volume over 0.3 btc</h1>

        <div id="volumeChart" class="volumeChart"></div>

        <h3 id="allTradeCounter">0 trades tottaly captured</h3>
        <h3 id="catchedTradeCounter">0 catched trades</h3>
        <h3 id="biggestTrade">Biggest trade in current section:</h3>

        <div id="tradeDiv"></div>


        <script>
            var binanceSocket = new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@trade");
            var trades = document.getElementById('tradeDiv')
            var allTradeCounter = document.getElementById('allTradeCounter')
            var allTradeCount = 0;
            var catchedTradesCounter = document.getElementById('catchedTradeCounter')
            var catchedTradeCount = 0;
            var biggestTrade = document.getElementById('biggestTrade')
            var biggestTradeFloat = 0;

            binanceSocket.onmessage = function (out){
                console.log(out.data);

                var messages = JSON.parse(out.data)
                var volume = parseFloat(messages.q)
                
                if ( volume > biggestTradeFloat){
                    biggestTradeFloat = volume;
                    biggestTrade.textContent = "Biggest trade in current section: " + biggestTradeFloat + "btc";
                }
                if ( volume > 0.3) {
                    trades.append(messages.q + " BTC trade has been opened on the price of " + messages.p)
                    trades.appendChild(document.createElement("br"))
                    catchedTradeCount++;
                    catchedTradesCounter.textContent = catchedTradeCount + " catched trades"
                }
                allTradeCount++;
                allTradeCounter.textContent = allTradeCount + " trades totally captured"
            }

        </script>
        <script src="chart.js"></script>
    </body>
</html>